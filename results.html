<body>
<h1>PhD Seminar Evaluation Results</h1>

<!-- Dropdown pro výběr semináře -->
<label for="seminarSelect">Select seminar:</label>
<select id="seminarSelect">
  <option value="">-- choose seminar --</option>
</select>

<div id="results"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA3oSDoF5LC6pweqVinV2ykpJopQwFWulM",
  authDomain: "phd-seminar-voting.firebaseapp.com",
  projectId: "phd-seminar-voting",
  storageBucket: "phd-seminar-voting.firebasestorage.app",
  messagingSenderId: "1042633812969",
  appId: "1:1042633812969:web:7fa70745a53338ec5ab978",
  measurementId: "G-2JQDJWPH7L"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Presenters per seminar ---
const presentationsBySeminar = {
  "Seminar 1": ["Marko Boskovic", "Pratibha Choudhari", "Samanta Rožánková", "Yu-Wei Tu"],
  "Seminar 2": ["Bart Kieftenbelt", "Ema Bažíková", "Büşra Buse Tütüncü", "Botond Bolgár"],
  "Seminar 3": ["Najam Ul Sahar", "Jialu Li", "Pipatpon Raksapon", "Andrea Vopálenská"],
  "Seminar 4": ["Filip Trajhan", "Donna Martínez Lopéz", "Pallavi Halkarni", "Ondřej Daněk"],
  "Seminar 5": ["Ondřej Hladík", "Alicia León Rodríguez", "Shubham Bhatt", "Jakub Krištof", "Nidhi Sinha"],
  "Seminar 6": ["Anna-Marie Dušková", "Lucie Černá", "Jyotpreet Kaur", "Sandip Baban Shinde", "Dominik Kunák"]
};

const seminars = Object.keys(presentationsBySeminar);
const seminarSelect = document.getElementById("seminarSelect");
const resultsDiv = document.getElementById("results");

// --- Naplnění dropdownu seznamem seminářů ---
seminars.forEach(s => {
  let opt = document.createElement("option");
  opt.value = s;
  opt.textContent = s;
  seminarSelect.appendChild(opt);
});

// --- Zobrazení výsledků jen pro vybraný seminář ---
async function displayResults(seminar) {
  resultsDiv.innerHTML = '';

  if (!seminar) return; // pokud nic není vybráno, nic nezobrazovat

  const snapshotVotes = await db.collection('votes').get();
  const numberOfVotes = snapshotVotes.size;

  const votesDiv = document.createElement("p");
  votesDiv.className = "votes";
  votesDiv.innerText = `${numberOfVotes} participants of the seminar submitted their votes`;
  resultsDiv.appendChild(votesDiv);

  const seminarVotes = snapshotVotes.docs.filter(doc => doc.data().seminar === seminar);
  const presNames = presentationsBySeminar[seminar];
  let totals = Array(presNames.length).fill(0);

  seminarVotes.forEach(doc => {
    doc.data().presentations.forEach((p,i)=>{
      totals[i] += p.score;
    });
  });

  const avgTotals = totals.map(t => (seminarVotes.length>0 ? (t/seminarVotes.length).toFixed(2) : 0));
  const ranked = avgTotals.map((score,index)=>({score: parseFloat(score), index}))
                         .sort((a,b)=>b.score-a.score);

  let seminarDiv = document.createElement("div");
  seminarDiv.className = "seminar";

  let html = `<h2>${seminar}</h2>`;
  ranked.forEach((r, pos)=>{
    html += `<p>${pos+1}. ${presNames[r.index]}: ${r.score} points</p>`;
  });

  const winnerIndex = ranked[0]?.index ?? 0;
  html += `<p class="winner">Winner: ${presNames[winnerIndex]} with ${avgTotals[winnerIndex]} points</p>`;
  seminarDiv.innerHTML = html;
  resultsDiv.appendChild(seminarDiv);

  // --- Confetti pro vítěze ---
  confetti({ particleCount: 100, spread: 120, origin: { y: 0.6 } });
}

// --- Reakce na změnu výběru v dropdownu ---
seminarSelect.addEventListener("change", e => {
  displayResults(e.target.value);
});
</script>
</body>

