<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PhD Seminar Scores</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; max-width: 900px; text-align: center; }
  h1 { color: #333; }
  .seminar { margin-bottom: 30px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; text-align: left; }
  .winner { font-weight: bold; color: green; }
  .overall { font-weight: bold; font-size: 1.5em; color: blue; margin-top: 20px; }
  .overall img { width: 200px; border-radius: 10px; margin-top: 10px; }
  .congrats { font-size: 2em; font-weight: bold; color: darkorange; margin-top: 10px; animation: pulse 1s infinite; display: none; }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  .votes { font-weight: bold; color: darkorange; margin-bottom: 15px; text-align: left; }
  p { margin: 4px 0; }
</style>
</head>
<body>
<h1>PhD Seminar Evaluation Results</h1>
<div id="results"></div>
<div id="overallWinner"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA3oSDoF5LC6pweqVinV2ykpJopQwFWulM",
  authDomain: "phd-seminar-voting.firebaseapp.com",
  projectId: "phd-seminar-voting",
  storageBucket: "phd-seminar-voting.firebasestorage.app",
  messagingSenderId: "1042633812969",
  appId: "1:1042633812969:web:7fa70745a53338ec5ab978",
  measurementId: "G-2JQDJWPH7L"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const presentationsBySeminar = {
  "Seminar 1": ["Alice", "Bob", "Charlie", "David", "Eva"],
  "Seminar 2": ["Frank", "Grace", "Hannah", "Ian", "Julia"],
  "Seminar 3": ["Kevin", "Laura", "Mike", "Nina", "Oscar"],
  "Seminar 4": ["Paul", "Quinn", "Rachel", "Steve", "Tina"],
  "Seminar 5": ["Uma", "Victor", "Wendy", "Xander", "Yara"],
  "Seminar 6": ["Zane", "Amy", "Brian", "Clara", "Derek"]
};

const seminars = Object.keys(presentationsBySeminar);
const resultsDiv = document.getElementById("results");
const overallDiv = document.getElementById("overallWinner");

let votingClosed = false;
let confettiLaunched = false;

function renderResults(snapshotVotes) {
  resultsDiv.innerHTML = '';
  overallDiv.innerHTML = '';

  const numberOfVotes = snapshotVotes.size;
  const votesDiv = document.createElement("p");
  votesDiv.className = "votes";
  votesDiv.innerText = `${numberOfVotes} participants of the seminar submitted their votes`;
  resultsDiv.appendChild(votesDiv);

  let globalScores = [];

  seminars.forEach(seminar => {
    const seminarVotes = snapshotVotes.docs.filter(doc => doc.data().seminar === seminar);
    const presNames = presentationsBySeminar[seminar];
    let totals = Array(presNames.length).fill(0);

    seminarVotes.forEach(doc => {
      doc.data().presentations.forEach((p, i) => {
        totals[i] += p.score;
      });
    });

    const numberOfVoters = seminarVotes.length || 1;
    let averages = totals.map(t => t / numberOfVoters);

    let results = presNames.map((name, i) => ({
      name: name,
      avg: averages[i]
    }));

    results.sort((a, b) => b.avg - a.avg);

    results.forEach(r => {
      globalScores.push({ seminar: seminar, name: r.name, avg: r.avg });
    });

    let seminarDiv = document.createElement("div");
    seminarDiv.className = "seminar";

    let html = `<h2>${seminar} (voters: ${numberOfVoters})</h2>`;
    results.forEach((r, i) => {
      html += `<p>${i + 1}. ${r.name}: ${r.avg.toFixed(2)} points</p>`;
    });

    html += `<p class="winner">Winner: ${results[0].name} with ${results[0].avg.toFixed(2)} points</p>`;
    seminarDiv.innerHTML = html;
    resultsDiv.appendChild(seminarDiv);
  });

  globalScores.sort((a, b) => b.avg - a.avg);
  const overallWinner = globalScores[0];

  overallDiv.innerHTML = `
    <div class="overall">
      üèÜ Overall Winner: ${overallWinner.name} (${overallWinner.seminar}) with ${overallWinner.avg.toFixed(2)} points
      <div id="congrats" class="congrats">üéâ Congratulations!!! üéâ</div>
      <img src="images/${overallWinner.name}.jpg" alt="${overallWinner.name}">
    </div>
  `;

  // Spust√≠me konfety a gratulaci pouze, pokud je hlasov√°n√≠ uzav≈ôeno
  if (votingClosed && !confettiLaunched) {
    document.getElementById("congrats").style.display = "block";
    confetti({
      particleCount: 200,
      spread: 120,
      origin: { y: 0.6 }
    });
    confettiLaunched = true;
  }
}

// sledujeme hlasy
db.collection('votes').onSnapshot(renderResults);

// sledujeme nastaven√≠ (uzav≈ôen√≠ hlasov√°n√≠)
db.collection('settings').doc('controls').onSnapshot(doc => {
  if (doc.exists && doc.data().votingClosed === true) {
    votingClosed = true;
  }
});
</script>
</body>
</html>


