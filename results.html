<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PhD Seminar Results</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<style>
body { 
  font-family: Arial; 
  margin: 0; 
  padding: 20px; 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
}

header {
  display: flex;
  flex-direction: column;  /* položky pod sebou */
  align-items: center;     /* zarovnání doprostřed */
  margin-bottom: 30px;
}

header img {
  height: 120px;   /* větší logo */
  margin-bottom: 10px;    
}

header h1 {
  margin: 0;
  color: #333;
  font-size: 28px;
  text-align: center;
}

#seminarSelectContainer {
  margin-bottom: 20px;
  text-align: center;
}

.seminar { 
  margin-bottom: 30px; 
  padding: 15px; 
  border: 1px solid #ccc; 
  border-radius: 8px; 
  display: inline-block;     
  text-align: center;        
  min-width: 300px;          
}

.winner { 
  font-weight: bold; 
  color: green; 
}

.votes { 
  font-weight: bold; 
  color: darkorange; 
  margin-bottom: 15px; 
  text-align: center;        
}

p { 
  margin: 4px 0; 
}
</style>
</head>
<body>

<header>
  <img src="logo.jpg" alt="Department Logo">
  <h1>PhD Seminar Evaluation Results</h1>
</header>

<div id="seminarSelectContainer">
  <label for="seminarSelect"><strong>Select seminar:</strong></label>
  <select id="seminarSelect">
    <option value="">-- choose seminar --</option>
    <option value="Seminar 1">Seminar 1</option>
    <option value="Seminar 2">Seminar 2</option>
    <option value="Seminar 3">Seminar 3</option>
    <option value="Seminar 4">Seminar 4</option>
    <option value="Seminar 5">Seminar 5</option>
    <option value="Seminar 6">Seminar 6</option>
  </select>
</div>

<div id="results"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA3oSDoF5LC6pweqVinV2ykpJopQwFWulM",
  authDomain: "phd-seminar-voting.firebaseapp.com",
  projectId: "phd-seminar-voting",
  storageBucket: "phd-seminar-voting.firebasestorage.app",
  messagingSenderId: "1042633812969",
  appId: "1:1042633812969:web:7fa70745a53338ec5ab978",
  measurementId: "G-2JQDJWPH7L"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const presentationsBySeminar = {
  "Seminar 1": ["Marko Boskovic", "Pratibha Choudhari", "Samanta Rožánková", "Yu-Wei Tu"],
  "Seminar 2": ["Bart Kieftenbelt", "Ema Bažíková", "Büşra Buse Tütüncü", "Botond Bolgár"],
  "Seminar 3": ["Najam Ul Sahar", "Jialu Li", "Pipatpon Raksapon", "Ondřej Daněk"],
  "Seminar 4": ["Filip Trajhan", "Donna Martínez Lopéz", "Pallavi Halkarni", "Andrea Vopálenská"],
  "Seminar 5": ["Ondřej Hladík", "Alicia León Rodríguez", "Shubham Bhatt", "Jakub Krištof", "Nidhi Sinha"],
  "Seminar 6": ["Anna-Marie Dušková", "Lucie Černá", "Jyotpreet Kaur", "Sandip Baban Shinde", "Dominik Kunák"]
};

const seminarSelect = document.getElementById("seminarSelect");
const resultsDiv = document.getElementById("results");

seminarSelect.addEventListener("change", async () => {
  const selected = seminarSelect.value;
  resultsDiv.innerHTML = ''; // vyčistí předchozí výsledky
  if (!selected) return;     // nic nezobrazovat pokud není vybrán seminář

  // načtení hlasů jen pro vybraný seminář
  const snapshotVotes = await db.collection('votes').where("seminar", "==", selected).get();
  const numberOfVotes = snapshotVotes.size;

  const votesDiv = document.createElement("p");
  votesDiv.className = "votes";
  votesDiv.innerText = `${numberOfVotes} participants of the seminar submitted their votes`;
  resultsDiv.appendChild(votesDiv);

  const presNames = presentationsBySeminar[selected];
  let totals = Array(presNames.length).fill(0);

  snapshotVotes.forEach(doc => {
    doc.data().presentations.forEach((p,i)=>{ totals[i] += p.score; });
  });

  const avgTotals = totals.map(t => (snapshotVotes.size>0 ? (t/snapshotVotes.size).toFixed(2) : 0));
  const ranked = avgTotals.map((score,index)=>({score: parseFloat(score), index}))
                         .sort((a,b)=>b.score-a.score);

  let seminarDiv = document.createElement("div");
  seminarDiv.className = "seminar";

  let html = `<h2>${selected}</h2>`;
  ranked.forEach((r,pos)=>{
    html += `<p>${pos+1}. ${presNames[r.index]}: ${r.score} points</p>`;
  });

  const winnerIndex = ranked[0]?.index ?? 0;
  html += `<p class="winner">Winner: ${presNames[winnerIndex]} with ${avgTotals[winnerIndex]} points</p>`;
  seminarDiv.innerHTML = html;
  resultsDiv.appendChild(seminarDiv);

  confetti({ particleCount: 100, spread: 120, origin: { y: 0.6 } });
});
</script>
</body>
</html>
