<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>PhD Seminar Feedback</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f8f9fa;
    }
    header {
      text-align: center;
      background: #004080;
      color: white;
      padding: 20px;
    }
    header img {
      height: 120px;
      display: block;
      margin: 0 auto 10px;
    }
    main {
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background: #004080;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #0059b3;
    }
    #comments {
      margin-top: 20px;
    }
    .comment {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    a.reset-link {
      display: inline-block;
      margin-top: 5px;
      font-size: 0.9em;
      color: #004080;
      cursor: pointer;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.jpg" alt="Department Logo">
    <h1>PhD Seminar Feedback</h1>
  </header>
  <main>
    <h2>Přihlášení</h2>
    <input type="email" id="email" placeholder="E-mail">
    <input type="password" id="password" placeholder="Heslo">
    <button onclick="login()">Přihlásit se</button>
    <a class="reset-link" onclick="resetPassword()">Zapomenuté heslo?</a>
    <div id="comments"></div>
    <button id="logoutBtn" onclick="logout()" style="display:none;">Odhlásit se</button>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script>
    // 🔧 Sem vlož svou Firebase konfiguraci
    const firebaseConfig = {
      apiKey: "TVŮJ_API_KEY",
      authDomain: "TVŮJ_PROJEKT.firebaseapp.com",
      projectId: "TVŮJ_PROJEKT",
      storageBucket: "TVŮJ_PROJEKT.appspot.com",
      messagingSenderId: "TVŮJ_SENDER_ID",
      appId: "TVŮJ_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Přihlášení
    function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      auth.signInWithEmailAndPassword(email, password)
        .then(userCred => {
          alert("Přihlášení úspěšné");
          loadComments(userCred.user);
          document.getElementById("logoutBtn").style.display = "block";
        })
        .catch(err => {
          alert("Chyba: " + err.message);
        });
    }

    // Reset hesla
    function resetPassword() {
      const email = document.getElementById("email").value.trim();
      if (!email) {
        alert("Zadej nejdřív svůj e-mail.");
        return;
      }
      auth.sendPasswordResetEmail(email)
        .then(() => {
          alert("E-mail pro reset hesla byl odeslán.");
        })
        .catch(err => {
          alert("Chyba: " + err.message);
        });
    }

    // Načtení komentářů pro přihlášeného prezentujícího
    function loadComments(user) {
      const name = user.displayName;
      if (!name) {
        alert("Tvůj účet nemá nastavené jméno (Display Name). Kontaktuj správce.");
        return;
      }
      document.getElementById("comments").innerHTML = "<h3>Komentáře pro: " + name + "</h3>";
      db.collection("votes").get().then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.presentations) {
            data.presentations.forEach(p => {
              if (p.name === name && p.comment) {
                const div = document.createElement("div");
                div.className = "comment";
                div.innerText = p.comment;
                document.getElementById("comments").appendChild(div);
              }
            });
          }
        });
      });
    }

    // Odhlášení
    function logout() {
      auth.signOut().then(() => {
        alert("Odhlášení proběhlo úspěšně.");
        document.getElementById("comments").innerHTML = "";
        document.getElementById("logoutBtn").style.display = "none";
      });
    }
  </script>
</body>
</html>
