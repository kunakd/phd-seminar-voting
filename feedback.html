<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PhD Seminar Feedback</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
header { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; }
header img { height: 120px; margin-bottom: 10px; }
header h1 { margin: 0; color: #333; font-size: 26px; }
input, textarea { padding: 8px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; width: 100%; max-width: 400px; }
button { padding: 8px 14px; border: none; border-radius: 6px; background: #4CAF50; color: white; cursor: pointer; margin-top: 5px; }
button:hover { background: #45a049; }
.error { color: red; font-weight: bold; margin-top: 10px; }
.comment-box { width: 100%; max-width: 600px; padding: 12px; margin: 8px 0; border-radius: 8px; background: #fff; box-shadow: 0 1px 5px rgba(0,0,0,0.08); border-left: 4px solid #4CAF50; }
</style>
</head>
<body>

<header>
  <img src="logo.jpg" alt="Department Logo">
  <h1>Feedback from the PhD Seminar</h1>
</header>

<!-- Login -->
<div id="loginForm">
  <input type="email" id="email" placeholder="Enter your email"><br>
  <input type="password" id="password" placeholder="Enter your password"><br>
  <button id="loginBtn">Login</button>
  <div id="errorMsg" class="error"></div>
</div>

<!-- Feedback sekce -->
<div id="feedbackSection" style="display:none; width:100%; max-width:600px;">
  <h3>Submit Feedback</h3>
  <textarea id="feedbackInput" placeholder="Enter your feedback..."></textarea><br>
  <button id="submitFeedbackBtn">Submit Feedback</button>
  <div id="submitMsg" class="error"></div>

  <h3>Your Feedback</h3>
  <div id="comments"></div>

  <div id="changePasswordForm" style="margin-top:20px;">
    <h3>Change Password</h3>
    <input type="password" id="newPassword" placeholder="Enter new password"><br>
    <button id="changePasswordBtn">Update Password</button>
    <div id="passwordMsg" class="error"></div>
  </div>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyA3oSDoF5LC6pweqVinV2ykpJopQwFWulM",
  authDomain: "phd-seminar-voting.firebaseapp.com",
  projectId: "phd-seminar-voting",
  storageBucket: "phd-seminar-voting.firebasestorage.app",
  messagingSenderId: "1042633812969",
  appId: "1:1042633812969:web:7fa70745a53338ec5ab978",
  measurementId: "G-2JQDJWPH7L"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Přihlášení
document.getElementById("loginBtn").addEventListener("click", async () => {
  const email = document.getElementById("email").value;
  const pass = document.getElementById("password").value;
  const errorMsg = document.getElementById("errorMsg");
  errorMsg.textContent = "";

  if (!email || !pass) {
    errorMsg.textContent = "Please enter email and password.";
    return;
  }

  try {
    const userCredential = await firebase.auth().signInWithEmailAndPassword(email, pass);
    const user = userCredential.user;
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("feedbackSection").style.display = "block";
    loadFeedback(user.email);
  } catch (error) {
    errorMsg.textContent = "Login failed: " + error.message;
  }
});

// Odeslat feedback
document.getElementById("submitFeedbackBtn").addEventListener("click", async () => {
  const feedback = document.getElementById("feedbackInput").value.trim();
  const submitMsg = document.getElementById("submitMsg");
  submitMsg.textContent = "";
  const user = firebase.auth().currentUser;

  if (!feedback) {
    submitMsg.textContent = "Please enter feedback.";
    return;
  }
  if (!user) {
    submitMsg.textContent = "You must be logged in.";
    return;
  }

  try {
    await db.collection("feedback").add({
      email: user.email,
      comment: feedback,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById("feedbackInput").value = "";
    submitMsg.style.color = "green";
    submitMsg.textContent = "Feedback submitted!";
    loadFeedback(user.email);
  } catch (err) {
    submitMsg.style.color = "red";
    submitMsg.textContent = "Error: " + err.message;
  }
});

// Načti feedback jen pro přihlášeného uživatele
async function loadFeedback(email) {
  const commentsDiv = document.getElementById("comments");
  commentsDiv.innerHTML = "";

  const snapshot = await db.collection("feedback")
    .where("email", "==", email)
    .orderBy("timestamp", "desc")
    .get();

  if (snapshot.empty) {
    commentsDiv.innerHTML = "<p>No feedback submitted yet.</p>";
  } else {
    snapshot.forEach(doc => {
      const data = doc.data();
      const box = document.createElement("div");
      box.className = "comment-box";
      box.textContent = data.comment;
      commentsDiv.appendChild(box);
    });
  }
}

// Změna hesla
document.getElementById("changePasswordBtn").addEventListener("click", async () => {
  const newPass = document.getElementById("newPassword").value;
  const passwordMsg = document.getElementById("passwordMsg");
  passwordMsg.textContent = "";
  const user = firebase.auth().currentUser;

  if (!user) {
    passwordMsg.textContent = "You must be logged in to change password.";
    return;
  }
  if (!newPass) {
    passwordMsg.textContent = "Please enter a new password.";
    return;
  }

  try {
    await user.updatePassword(newPass);
    passwordMsg.style.color = "green";
    passwordMsg.textContent = "Password updated successfully!";
  } catch (error) {
    passwordMsg.style.color = "red";
    passwordMsg.textContent = "Error: " + error.message;
  }
});
</script>
</body>
</html>
