<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PhD Seminar Evaluation</title>
<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Mobilní optimalizace -->

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* ---------- Základní styl ---------- */
html, body {
  min-height: 100%;
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
}

body {
  width: 100%;
  padding: 20px;
  box-sizing: border-box;
  flex: 1;
}

header {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 25px;
}

header img {
  height: 120px;
  margin-bottom: 10px;
}

header h1 {
  margin: 0;
  color: #333;
  font-size: 28px;
  text-align: center;
}

.navbar {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 15px;
}

.nav-btn {
  padding: 10px 18px;
  background: #4a4a4a;
  color: white;
  border-radius: 6px;
  text-decoration: none;
  font-size: 15px;
  transition: background 0.2s;
}

.nav-btn:hover {
  background: #000;
}

label {
  display: block;
  margin-top: 15px;
  font-weight: bold;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 4px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  font-size: 16px;
}

textarea {
  resize: vertical;
  transition: background-color 0.2s, color 0.2s;
}

textarea:disabled {
  background-color: #eee;
  color: #666;
}

button {
  font-size: 16px;
  margin-top: 12px;
  cursor: pointer;
}

.success { color: green; margin-top: 15px; }
.error { color: red; margin-top: 15px; }

.presentation-block {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 15px;
  margin-top: 20px;
  background: #fafafa;
  box-shadow: 1px 1px 5px rgba(0,0,0,0.05);
}

.presentation-block h3 { margin-top: 0; color: #444; }

.checkbox-row {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 6px;
  margin-top: 5px;
}

.checkbox-row input[type="checkbox"] {
  width: auto;
  cursor:pointer;
}

.checkbox-row label {
  margin: 0;
  cursor: pointer;
}

footer {
  background-color: #ffffff;
  text-align: center;
  padding: 25px 15px;
  font-size: 14px;
  color: #000;
  border-top: 1px solid #ccc;
  margin-top: auto;
}

/* ---------- Mobilní responzivita ---------- */
@media (max-width: 600px) {
  header img { height: 90px; }
  header h1 { font-size: 22px; }
  .nav-btn { font-size: 16px; padding: 10px; }
  input, select, textarea, button { font-size: 16px; padding: 12px; }
  .presentation-block { font-size: 16px; padding: 15px; }
}
</style>
</head>
<body>

<header>
  <img src="logo.jpg" alt="Department Logo">
  <h1>PhD Seminar Evaluation</h1>
  <div class="navbar">
    <a href="https://kunakd.github.io/phd-seminar-voting/results.html" class="nav-btn">Results</a>
    <a href="https://kunakd.github.io/phd-seminar-voting/feedback.html" class="nav-btn">Feedback</a>
  </div>
</header>

<div style="border: 2px solid #444; padding: 12px 15px; border-radius: 6px; background: #fff; margin-bottom: 20px;">
  <h3 style="margin:0 0 8px 0; font-size:16px; text-align:center; font-weight:bold;">Instructions for Email/Name</h3>
  <p style="margin:0; font-size:14px; line-height:1.45; text-align:left;">
    <strong>Students:</strong> Enter your faculty email (...@natur.cuni.cz) or IOCB email (...@uochb.cas.cz).<br>
    <strong>Academic staff:</strong> Enter your full name (name and surname).
  </p>
</div>

<form id="voteForm">
  <label for="participantId">Email/Name</label>
  <input type="text" id="participantId" required>

  <label for="seminar">Select seminar</label>
  <select id="seminar" required>
    <option value="">--Select--</option>
  </select>

  <div id="presentations"></div>

  <button type="submit" id="submitBtn">Submit evaluation</button>
</form>

<div id="message" aria-live="polite"></div>

<script>
// ------------------- Firebase init -------------------
const firebaseConfig = {
  apiKey: "AIzaSyA3oSDoF5LC6pweqVinV2ykpJopQwFWulM",
  authDomain: "phd-seminar-voting.firebaseapp.com",
  projectId: "phd-seminar-voting",
  storageBucket: "phd-seminar-voting.firebasestorage.app",
  messagingSenderId: "1042633812969",
  appId: "1:1042633812969:web:7fa70745a53338ec5ab978"
};

let db = null;
try {
  firebase.initializeApp(firebaseConfig);
  db = firebase.firestore();
} catch (e) {
  console.error('Firebase init error', e);
  alert('Warning: backend failed to initialize. Drafts will be saved locally.');
}

// ------------------- Data -------------------
const seminars = [
  { name: "Seminar 1", date: "2025-11-14" },
  { name: "Seminar 2", date: "2025-12-12" },
  { name: "Seminar 3", date: "2026-01-16" },
  { name: "Seminar 4", date: "2026-02-13" },
  { name: "Seminar 5", date: "2026-04-10" },
  { name: "Seminar 6", date: "2026-05-15" }
];

const presentationsBySeminar = {
  "Seminar 1": ["Marko Boskovic", "Büşra Buse Tütüncü", "Samanta Rožánková", "Yu-Wei Tu"],
  "Seminar 2": ["Bart Kieftenbelt", "Ema Bažíková", "Pratibha Choudhari"],
  "Seminar 3": ["Anna-Marie Dušková", "Pallavi Halkarni", "Pipatpon Raksapon", "Ondřej Daněk"],
  "Seminar 4": ["Filip Trajhan", "Alicia León Rodríguez", "Jakub Krištof", "Andrea Vopálenská"],
  "Seminar 5": ["Ondřej Hladík", "Lucie Černá", "Shubham Bhatt", "Nidhi Sinha"],
  "Seminar 6": ["Najam Ul Sahar", "Jyotpreet Kaur", "Sandip Baban Shinde", "Dominik Kunák"]
};

// ------------------- Populate seminar dropdown -------------------
const seminarSelect = document.getElementById("seminar");
function updateSeminarDropdown(){
  seminarSelect.innerHTML = '<option value="">--Select--</option>';
  const now = new Date();
  seminars.forEach(s=>{
    const date = new Date(s.date);
    const openDate = new Date(date); openDate.setDate(openDate.getDate()-1);
    const opt = document.createElement('option');
    opt.value = s.name;
    opt.textContent = `${s.name} on ${date.toLocaleDateString('en-GB')}`;
    if(now < openDate){ opt.disabled = true; opt.textContent += ' (not yet open)'; opt.title = `Voting opens ${openDate.toLocaleDateString('en-GB')}`; }
    seminarSelect.appendChild(opt);
  });
}
updateSeminarDropdown();

// ------------------- Render presentations -------------------
const presDiv = document.getElementById("presentations");
function renderPresentations(seminar){
  presDiv.innerHTML = '';
  if(!seminar) return;
  const list = presentationsBySeminar[seminar] || [];
  list.forEach((name,i)=>{
    const block = document.createElement('div');
    block.className = 'presentation-block';
    block.innerHTML = `
      <h3>${name}</h3>
      <label>Score (1 = worst, 10 = best)</label>
      <select id="pres${i+1}" data-idx="${i}" required>
        <option value="">--Select--</option>
        ${Array.from({length:10},(_,x)=>`<option value="${x+1}">${x+1}</option>`).join('')}
      </select>
      <label>What should be improved?</label>
      <textarea id="comment${i+1}" data-idx="${i}" rows="3"></textarea>
      <div class="checkbox-row">
        <input type="checkbox" id="nocmt${i+1}" data-idx="${i}">
        <label for="nocmt${i+1}">No comments</label>
      </div>
    `;
    presDiv.appendChild(block);
    const checkbox = block.querySelector(`#nocmt${i+1}`);
    const textarea = block.querySelector(`#comment${i+1}`);
    checkbox.addEventListener('change', ()=>{ textarea.disabled = checkbox.checked; if(checkbox.checked) textarea.value=''; });
  });
}

// ------------------- Event listeners -------------------
seminarSelect.addEventListener('change', ()=>renderPresentations(seminarSelect.value));

</script>

<footer>
  <img src="logo.jpg" alt="Faculty Logo" style="height: 55px; margin-bottom: 10px;">
  <p style="margin: 6px 0;">© 2025 Department of Organic Chemistry, Faculty of Science, Charles University</p>
  <p style="margin: 6px 0;">Hlavova 2030/8, Prague 2, 128 00 | Seminar Contacts: jiri.misek@natur.cuni.cz; dominik.kunak@natur.cuni.cz</p>
  <p style="margin: 6px 0;"><a href="https://orgchem.natur.cuni.cz/" target="_blank" style="color: #000; text-decoration: none;">https://orgchem.natur.cuni.cz</a></p>
</footer>

</body>
</html>
