<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PhD Seminar Evaluation</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial; max-width: 800px; margin: 30px auto; padding: 20px; }
header { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; }
header img { height: 120px; margin-bottom: 10px; }
header h1 { margin: 0; color: #333; font-size: 28px; text-align: center; }
label { display:block; margin-top:15px; font-weight:bold; }
input, select, textarea, button { width:100%; padding:8px; margin-top:5px; border-radius:4px; border:1px solid #ccc; box-sizing:border-box; }
textarea { resize: vertical; transition: background-color 0.2s, color 0.2s; }
button { font-size:16px; margin-top:10px; cursor: pointer; }
.success { color: green; margin-top:20px; }
.error { color: red; margin-top:20px; }
.presentation-block { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin-top: 20px; background: #fafafa; box-shadow: 1px 1px 5px rgba(0,0,0,0.05);}
.presentation-block h3 { margin-top: 0; color: #444; }
.checkbox-row { display: flex; align-items: center; margin-top: 5px; gap: 5px; }
.checkbox-row input[type="checkbox"] { width: auto; cursor:pointer; }
textarea:disabled { background-color: #eee; color: #666; }
</style>
</head>
<body>

<header>
  <img src="logo.jpg" alt="Department Logo">
  <h1>PhD Seminar Evaluation</h1>
</header>

<form id="voteForm">
  <label for="participantId">Participant ID</label>
  <input type="text" id="participantId" required>

  <label for="seminar">Select seminar</label>
  <select id="seminar" required>
    <option value="">--Select--</option>
    <option value="Seminar 1">Seminar 1 on 14.November 2025</option>
    <option value="Seminar 2">Seminar 2 on 12.December 2025</option>
    <option value="Seminar 3">Seminar 3 on 16.January 2026</option>
    <option value="Seminar 4">Seminar 4 on 13.February 2026</option>
    <option value="Seminar 5">Seminar 5 on 10.April 2026</option>
    <option value="Seminar 6">Seminar 6 on 15.May 2026</option>
  </select>

  <div id="presentations"></div>

  <button type="submit">Submit evaluation</button>
</form>

<div id="message"></div>

<script>
// --- Firebase configuration ---
const firebaseConfig = {
  apiKey: "AIzaSyA3oSDoF5LC6pweqVinV2ykpJopQwFWulM",
  authDomain: "phd-seminar-voting.firebaseapp.com",
  projectId: "phd-seminar-voting",
  storageBucket: "phd-seminar-voting.firebasestorage.app",
  messagingSenderId: "1042633812969",
  appId: "1:1042633812969:web:7fa70745a53338ec5ab978"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Presenters ---
const presentationsBySeminar = {
  "Seminar 1": ["Marko Boskovic", "Pratibha Choudhari", "Samanta Rožánková", "Yu-Wei Tu"],
  "Seminar 2": ["Bart Kieftenbelt", "Ema Bažíková", "Büşra Buse Tütüncü", "Botond Bolgár"],
  "Seminar 3": ["Najam Ul Sahar", "Jialu Li", "Pipatpon Raksapon", "Ondřej Daněk"],
  "Seminar 4": ["Filip Trajhan", "Alicia León Rodríguez", "Pallavi Halkarni", "Andrea Vopálenská"],
  "Seminar 5": ["Ondřej Hladík", "Donna Martínez Lopéz", "Shubham Bhatt", "Jakub Krištof", "Nidhi Sinha"],
  "Seminar 6": ["Anna-Marie Dušková", "Lucie Černá", "Jyotpreet Kaur", "Sandip Baban Shinde", "Dominik Kunák"]
};

const presDiv = document.getElementById("presentations");
const seminarSelect = document.getElementById("seminar");

// --- Render presentations with "No comments" checkbox ---
function renderPresentations(seminar) {
  presDiv.innerHTML = '';
  if(!seminar) return;
  const presNames = presentationsBySeminar[seminar] || [];
  presNames.forEach((name,i)=>{
    const block = document.createElement("div");
    block.className = "presentation-block";
    block.innerHTML = `
      <h3>${name}</h3>
      <label for="pres${i+1}">Score (1 = worst, 10 = best)</label>
      <select id="pres${i+1}" required>
        <option value="">--Select--</option>
        ${Array.from({length:10}, (_,j)=>`<option value="${j+1}">${j+1}</option>`).join("")}
      </select>
      <label for="comment${i+1}">What should be improved?</label>
      <textarea id="comment${i+1}" rows="3"></textarea>
      <div class="checkbox-row">
        <input type="checkbox" id="nocmt${i+1}">
        <label for="nocmt${i+1}">No comments</label>
      </div>
    `;
    presDiv.appendChild(block);

    const checkbox = block.querySelector(`#nocmt${i+1}`);
    const textarea = block.querySelector(`#comment${i+1}`);

    // --- Enable/disable textarea based on checkbox ---
    checkbox.addEventListener('change', ()=>{
      if(checkbox.checked){
        textarea.disabled = true;
        textarea.value = "";
      }else{
        textarea.disabled = false;
      }
    });
  });
}
seminarSelect.addEventListener('change', e=>renderPresentations(e.target.value));

// --- Submit ---
const form = document.getElementById('voteForm');
const message = document.getElementById('message');

form.addEventListener('submit', async e=>{
  e.preventDefault();
  const participantId = document.getElementById('participantId').value.trim();
  const seminar = seminarSelect.value;
  const presNames = presentationsBySeminar[seminar] || [];
  let presentations = [];

  if(!participantId || !seminar){
    message.textContent = 'Please fill in all required fields.';
    message.className = 'error';
    return;
  }

  for(let i=0;i<presNames.length;i++){
    const score = document.getElementById(`pres${i+1}`).value;
    const comment = document.getElementById(`comment${i+1}`).value.trim();
    const noCommentChecked = document.getElementById(`nocmt${i+1}`).checked;

    if(!score){
      message.textContent = 'Please fill in a score for each presentation.';
      message.className = 'error';
      return;
    }

    presentations.push({
      name: presNames[i],
      score: parseInt(score),
      comment: noCommentChecked ? "" : comment
    });
  }

  try{
    console.log('Submitting vote:', participantId, seminar, presentations);

    const docRef = db.collection('votes').doc(`${participantId}_${seminar}`);
    const doc = await docRef.get();
    if(doc.exists){
      message.textContent = 'You have already submitted an evaluation for this seminar.';
      message.className = 'error';
      return;
    }

    await docRef.set({
      participantId,
      seminar,
      presentations,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    message.textContent = 'Evaluation submitted successfully. Thank you!';
    message.className = 'success';
    form.reset();
    presDiv.innerHTML = '';
  }catch(err){
    console.error(err);
    message.textContent = 'An error occurred while submitting.';
    message.className = 'error';
  }
});
</script>

</body>
</html>

